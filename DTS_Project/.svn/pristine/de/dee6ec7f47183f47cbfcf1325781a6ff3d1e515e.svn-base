using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Windows.Forms;

namespace DTS_Project
{
    /// <summary>
    /// Created: Mar 31, 2013 by Tyler Vanover
    /// 
    /// Description: The telephone is used by the 
    /// tenant. Each tenant must enter their access code before
    /// given use of the telephone. After it has been determined
    /// they are a valid user, the system will prompt them
    /// for a telephone number, make sure the number isn't barred, and
    /// then proceed to log the call.
    /// </summary>
    public class Telephone
    {
        private Tenant _workingTenant;

        public Telephone()
        {
        }

        public void Activate(ref Terminal _terminal)
        {
            AccessCodeDialog accessDiag = new AccessCodeDialog();
            if (accessDiag.ShowDialog() == DialogResult.OK)
            {
                if (_terminal.RetrieveRegisteredUser(accessDiag.AccessCode, out _workingTenant))
                {
                    TelephoneDialog telly = new TelephoneDialog();
                    if (telly.ShowDialog() == DialogResult.OK)
                    {
                        if (_workingTenant.IsNotBarred(new Number(telly.TelephoneNumber)))
                        {
                            ConnectedDialog connected = new ConnectedDialog();
                            DateTime placed = DateTime.Now;
                            if (connected.ShowDialog() == DialogResult.OK)
                            {
                                DateTime ended = DateTime.Now;
                                _workingTenant.UpdateCallLog(new Call(new Number(telly.TelephoneNumber), placed, ended));
                            }
                        }
                    }
                }
            }
        }

    }
}
